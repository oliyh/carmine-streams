<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: consumer_state Pages: 1 -->
<svg width="1156pt" height="688pt"
 viewBox="0.00 0.00 1156.39 687.95" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 683.95)">
<title>consumer_state</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-683.95 1152.39,-683.95 1152.39,4 -4,4"/>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<text text-anchor="middle" x="915.39" y="-668.75" font-family="Times,serif" font-size="14.00">start</text>
</g>
<!-- state_pending -->
<g id="node2" class="node">
<title>state_pending</title>
<ellipse fill="none" stroke="black" cx="915.39" cy="-590.48" rx="113.27" ry="37.45"/>
<text text-anchor="middle" x="915.39" y="-601.78" font-family="Times,serif" font-size="14.00">(e.g. &quot;0&#45;0&quot;)</text>
<text text-anchor="middle" x="915.39" y="-586.78" font-family="Times,serif" font-size="14.00"> looking for pending</text>
<text text-anchor="middle" x="915.39" y="-571.78" font-family="Times,serif" font-size="14.00"> messages</text>
</g>
<!-- start&#45;&gt;state_pending -->
<g id="edge1" class="edge">
<title>start&#45;&gt;state_pending</title>
<path fill="none" stroke="black" d="M915.39,-664.91C915.39,-658.75 915.39,-648.91 915.39,-638.42"/>
<polygon fill="black" stroke="black" points="918.89,-638.26 915.39,-628.26 911.89,-638.26 918.89,-638.26"/>
</g>
<!-- decision_pending -->
<g id="node4" class="node">
<title>decision_pending</title>
<polygon fill="none" stroke="black" points="726.39,-516 568.39,-463 726.39,-410 884.39,-463 726.39,-516"/>
<text text-anchor="middle" x="726.39" y="-474.3" font-family="Times,serif" font-size="14.00">pending</text>
<text text-anchor="middle" x="726.39" y="-459.3" font-family="Times,serif" font-size="14.00"> messages found on</text>
<text text-anchor="middle" x="726.39" y="-444.3" font-family="Times,serif" font-size="14.00"> this stream?</text>
</g>
<!-- state_pending&#45;&gt;decision_pending -->
<g id="edge2" class="edge">
<title>state_pending&#45;&gt;decision_pending</title>
<path fill="none" stroke="black" d="M865.73,-556.51C841.66,-540.53 812.53,-521.19 787.14,-504.33"/>
<polygon fill="black" stroke="black" points="788.95,-501.34 778.69,-498.72 785.08,-507.17 788.95,-501.34"/>
</g>
<!-- state_new -->
<g id="node3" class="node">
<title>state_new</title>
<ellipse fill="none" stroke="black" cx="88.39" cy="-590.48" rx="88.28" ry="37.45"/>
<text text-anchor="middle" x="88.39" y="-601.78" font-family="Times,serif" font-size="14.00">&quot;&gt;&quot;</text>
<text text-anchor="middle" x="88.39" y="-586.78" font-family="Times,serif" font-size="14.00"> looking for</text>
<text text-anchor="middle" x="88.39" y="-571.78" font-family="Times,serif" font-size="14.00"> new messages</text>
</g>
<!-- new_message -->
<g id="node10" class="node">
<title>new_message</title>
<polygon fill="none" stroke="black" points="241.39,-501 116.39,-463 241.39,-425 366.39,-463 241.39,-501"/>
<text text-anchor="middle" x="241.39" y="-466.8" font-family="Times,serif" font-size="14.00">a new message</text>
<text text-anchor="middle" x="241.39" y="-451.8" font-family="Times,serif" font-size="14.00"> arrives?</text>
</g>
<!-- state_new&#45;&gt;new_message -->
<g id="edge12" class="edge">
<title>state_new&#45;&gt;new_message</title>
<path fill="none" stroke="black" d="M128.19,-556.84C150.27,-538.73 177.69,-516.24 200.02,-497.93"/>
<polygon fill="black" stroke="black" points="202.48,-500.43 208,-491.39 198.04,-495.02 202.48,-500.43"/>
</g>
<!-- decision_pending&#45;&gt;state_new -->
<g id="edge4" class="edge">
<title>decision_pending&#45;&gt;state_new</title>
<path fill="none" stroke="black" d="M642.65,-487.92C588.2,-502.89 515.48,-521.77 450.39,-535 360.27,-553.32 256.38,-568.34 183.07,-577.93"/>
<polygon fill="black" stroke="black" points="182.4,-574.49 172.94,-579.24 183.3,-581.43 182.4,-574.49"/>
<text text-anchor="middle" x="633.65" y="-491.72" font-family="Times,serif" font-size="14.00">no</text>
</g>
<!-- decision_process -->
<g id="node5" class="node">
<title>decision_process</title>
<polygon fill="none" stroke="black" points="726.39,-314 502.39,-261 726.39,-208 950.39,-261 726.39,-314"/>
<text text-anchor="middle" x="726.39" y="-272.3" font-family="Times,serif" font-size="14.00">this is the</text>
<text text-anchor="middle" x="726.39" y="-257.3" font-family="Times,serif" font-size="14.00"> highest priority stream with</text>
<text text-anchor="middle" x="726.39" y="-242.3" font-family="Times,serif" font-size="14.00"> a message on it?</text>
</g>
<!-- decision_pending&#45;&gt;decision_process -->
<g id="edge3" class="edge">
<title>decision_pending&#45;&gt;decision_process</title>
<path fill="none" stroke="black" d="M726.39,-409.97C726.39,-383.8 726.39,-351.89 726.39,-324.41"/>
<polygon fill="black" stroke="black" points="729.89,-324.11 726.39,-314.11 722.89,-324.11 729.89,-324.11"/>
<text text-anchor="middle" x="713.89" y="-398.77" font-family="Times,serif" font-size="14.00">yes</text>
</g>
<!-- process_message -->
<g id="node6" class="node">
<title>process_message</title>
<polygon fill="none" stroke="black" points="795.39,-132.5 657.39,-132.5 657.39,-96.5 795.39,-96.5 795.39,-132.5"/>
<text text-anchor="middle" x="726.39" y="-110.8" font-family="Times,serif" font-size="14.00">process message</text>
</g>
<!-- decision_process&#45;&gt;process_message -->
<g id="edge5" class="edge">
<title>decision_process&#45;&gt;process_message</title>
<path fill="none" stroke="black" d="M726.39,-207.83C726.39,-185.9 726.39,-161.3 726.39,-143"/>
<polygon fill="black" stroke="black" points="729.89,-142.77 726.39,-132.77 722.89,-142.77 729.89,-142.77"/>
<text text-anchor="middle" x="713.89" y="-196.63" font-family="Times,serif" font-size="14.00">yes</text>
</g>
<!-- not_processed -->
<g id="node7" class="node">
<title>not_processed</title>
<polygon fill="none" stroke="black" points="1016.89,-141 855.89,-141 855.89,-88 1016.89,-88 1016.89,-141"/>
<text text-anchor="middle" x="936.39" y="-125.8" font-family="Times,serif" font-size="14.00">message has not</text>
<text text-anchor="middle" x="936.39" y="-110.8" font-family="Times,serif" font-size="14.00"> been processed,</text>
<text text-anchor="middle" x="936.39" y="-95.8" font-family="Times,serif" font-size="14.00"> give it another shot</text>
</g>
<!-- decision_process&#45;&gt;not_processed -->
<g id="edge6" class="edge">
<title>decision_process&#45;&gt;not_processed</title>
<path fill="none" stroke="black" d="M782.66,-221.28C816.57,-197.95 859.18,-168.63 890.94,-146.77"/>
<polygon fill="black" stroke="black" points="892.92,-149.66 899.18,-141.1 888.95,-143.89 892.92,-149.66"/>
<text text-anchor="middle" x="773.66" y="-210.08" font-family="Times,serif" font-size="14.00">no</text>
</g>
<!-- message_origin -->
<g id="node8" class="node">
<title>message_origin</title>
<polygon fill="none" stroke="black" points="726.39,-36 611.6,-18 726.39,0 841.18,-18 726.39,-36"/>
<text text-anchor="middle" x="726.39" y="-14.3" font-family="Times,serif" font-size="14.00">message origin</text>
</g>
<!-- process_message&#45;&gt;message_origin -->
<g id="edge8" class="edge">
<title>process_message&#45;&gt;message_origin</title>
<path fill="none" stroke="black" d="M726.39,-96.17C726.39,-82.31 726.39,-62.63 726.39,-46.61"/>
<polygon fill="black" stroke="black" points="729.89,-46.22 726.39,-36.22 722.89,-46.22 729.89,-46.22"/>
</g>
<!-- not_processed&#45;&gt;state_pending -->
<g id="edge7" class="edge">
<title>not_processed&#45;&gt;state_pending</title>
<path fill="none" stroke="black" d="M946.07,-141.27C951.15,-156.15 956.83,-175.36 959.39,-193 977.72,-319.17 946.93,-468.9 928.19,-543.07"/>
<polygon fill="black" stroke="black" points="924.73,-542.46 925.63,-553.02 931.51,-544.21 924.73,-542.46"/>
<text text-anchor="middle" x="1039.89" y="-380.8" font-family="Times,serif" font-size="14.00">same message ID as</text>
<text text-anchor="middle" x="1039.89" y="-365.8" font-family="Times,serif" font-size="14.00">before, or &quot;0&#45;0&quot;</text>
<text text-anchor="middle" x="1039.89" y="-350.8" font-family="Times,serif" font-size="14.00">if the message is new</text>
</g>
<!-- message_origin&#45;&gt;state_new -->
<g id="edge11" class="edge">
<title>message_origin&#45;&gt;state_new</title>
<path fill="none" stroke="black" d="M659.13,-25.51C573.46,-37.94 436.39,-73.53 436.39,-174 436.39,-464 436.39,-464 436.39,-464 436.39,-518.38 284.08,-555.73 180.99,-574.78"/>
<polygon fill="black" stroke="black" points="180.07,-571.39 170.86,-576.62 181.32,-578.27 180.07,-571.39"/>
<text text-anchor="middle" x="644.13" y="-29.31" font-family="Times,serif" font-size="14.00">new</text>
</g>
<!-- next_id -->
<g id="node9" class="node">
<title>next_id</title>
<polygon fill="none" stroke="black" points="1063.89,-36 994.89,-36 994.89,0 1063.89,0 1063.89,-36"/>
<text text-anchor="middle" x="1029.39" y="-14.3" font-family="Times,serif" font-size="14.00">next ID</text>
</g>
<!-- message_origin&#45;&gt;next_id -->
<g id="edge9" class="edge">
<title>message_origin&#45;&gt;next_id</title>
<path fill="none" stroke="black" d="M841.2,-18C889.01,-18 936.82,-18 984.63,-18"/>
<polygon fill="black" stroke="black" points="984.84,-21.5 994.84,-18 984.84,-14.5 984.84,-21.5"/>
<text text-anchor="middle" x="870.2" y="-21.8" font-family="Times,serif" font-size="14.00">pending</text>
</g>
<!-- next_id&#45;&gt;state_pending -->
<g id="edge10" class="edge">
<title>next_id&#45;&gt;state_pending</title>
<path fill="none" stroke="black" d="M1064.13,-29.96C1099.25,-43.46 1148.39,-70.1 1148.39,-113.5 1148.39,-464 1148.39,-464 1148.39,-464 1148.39,-524.17 1087.41,-555.61 1027.85,-571.98"/>
<polygon fill="black" stroke="black" points="1026.71,-568.66 1017.92,-574.57 1028.48,-575.43 1026.71,-568.66"/>
</g>
<!-- new_message&#45;&gt;decision_process -->
<g id="edge13" class="edge">
<title>new_message&#45;&gt;decision_process</title>
<path fill="none" stroke="black" d="M293.29,-440.6C375.28,-406.79 535.81,-340.59 636.72,-298.98"/>
<polygon fill="black" stroke="black" points="638.08,-302.2 645.99,-295.15 635.42,-295.73 638.08,-302.2"/>
<text text-anchor="middle" x="306.83" y="-422.17" font-family="Times,serif" font-size="14.00">yes</text>
</g>
<!-- decision_idle -->
<g id="node11" class="node">
<title>decision_idle</title>
<polygon fill="none" stroke="black" points="241.39,-329 74.39,-261 241.39,-193 408.39,-261 241.39,-329"/>
<text text-anchor="middle" x="241.39" y="-279.8" font-family="Times,serif" font-size="14.00">consumer is idle</text>
<text text-anchor="middle" x="241.39" y="-264.8" font-family="Times,serif" font-size="14.00"> and has not checked</text>
<text text-anchor="middle" x="241.39" y="-249.8" font-family="Times,serif" font-size="14.00"> the pending queue</text>
<text text-anchor="middle" x="241.39" y="-234.8" font-family="Times,serif" font-size="14.00"> in a while</text>
</g>
<!-- new_message&#45;&gt;decision_idle -->
<g id="edge14" class="edge">
<title>new_message&#45;&gt;decision_idle</title>
<path fill="none" stroke="black" d="M241.39,-424.85C241.39,-400.9 241.39,-368.86 241.39,-339.54"/>
<polygon fill="black" stroke="black" points="244.89,-339.3 241.39,-329.3 237.89,-339.3 244.89,-339.3"/>
<text text-anchor="middle" x="307.89" y="-380.8" font-family="Times,serif" font-size="14.00">timed out or</text>
<text text-anchor="middle" x="307.89" y="-365.8" font-family="Times,serif" font-size="14.00">found a message</text>
<text text-anchor="middle" x="307.89" y="-350.8" font-family="Times,serif" font-size="14.00">on another stream</text>
</g>
<!-- decision_idle&#45;&gt;state_new -->
<g id="edge16" class="edge">
<title>decision_idle&#45;&gt;state_new</title>
<path fill="none" stroke="black" d="M186.61,-306.89C157.96,-333.66 125.22,-370.13 107.39,-410 88.56,-452.09 85.1,-505.1 85.56,-542.56"/>
<polygon fill="black" stroke="black" points="82.06,-542.78 85.79,-552.7 89.06,-542.62 82.06,-542.78"/>
<text text-anchor="middle" x="179.35" y="-321.83" font-family="Times,serif" font-size="14.00">no</text>
</g>
<!-- check_queue -->
<g id="node12" class="node">
<title>check_queue</title>
<polygon fill="none" stroke="black" points="358.39,-156 124.39,-156 124.39,-73 358.39,-73 358.39,-156"/>
<text text-anchor="middle" x="241.39" y="-140.8" font-family="Times,serif" font-size="14.00">look at this consumer&#39;s own</text>
<text text-anchor="middle" x="241.39" y="-125.8" font-family="Times,serif" font-size="14.00"> pending messages and other</text>
<text text-anchor="middle" x="241.39" y="-110.8" font-family="Times,serif" font-size="14.00"> consumers&#39; idle messages.</text>
<text text-anchor="middle" x="241.39" y="-95.8" font-family="Times,serif" font-size="14.00"> claim them or put in the DLQ,</text>
<text text-anchor="middle" x="241.39" y="-80.8" font-family="Times,serif" font-size="14.00"> as appropriate.</text>
</g>
<!-- decision_idle&#45;&gt;check_queue -->
<g id="edge15" class="edge">
<title>decision_idle&#45;&gt;check_queue</title>
<path fill="none" stroke="black" d="M241.39,-192.83C241.39,-183.92 241.39,-174.91 241.39,-166.34"/>
<polygon fill="black" stroke="black" points="244.89,-166.14 241.39,-156.14 237.89,-166.14 244.89,-166.14"/>
<text text-anchor="middle" x="228.89" y="-181.63" font-family="Times,serif" font-size="14.00">yes</text>
</g>
<!-- decision_claimed -->
<g id="node13" class="node">
<title>decision_claimed</title>
<polygon fill="none" stroke="black" points="241.39,-36 140.17,-18 241.39,0 342.6,-18 241.39,-36"/>
<text text-anchor="middle" x="241.39" y="-14.3" font-family="Times,serif" font-size="14.00">claimed any?</text>
</g>
<!-- check_queue&#45;&gt;decision_claimed -->
<g id="edge17" class="edge">
<title>check_queue&#45;&gt;decision_claimed</title>
<path fill="none" stroke="black" d="M241.39,-72.88C241.39,-63.97 241.39,-54.75 241.39,-46.5"/>
<polygon fill="black" stroke="black" points="244.89,-46.33 241.39,-36.33 237.89,-46.33 244.89,-46.33"/>
</g>
<!-- decision_claimed&#45;&gt;state_pending -->
<g id="edge18" class="edge">
<title>decision_claimed&#45;&gt;state_pending</title>
<path fill="none" stroke="black" d="M287.14,-27.87C355,-43.98 474.39,-84.97 474.39,-174 474.39,-464 474.39,-464 474.39,-464 474.39,-531.11 665.69,-564.25 796.3,-579.05"/>
<polygon fill="black" stroke="black" points="796.05,-582.55 806.38,-580.17 796.82,-575.59 796.05,-582.55"/>
<text text-anchor="middle" x="274.64" y="-31.67" font-family="Times,serif" font-size="14.00">yes</text>
</g>
<!-- decision_claimed&#45;&gt;state_new -->
<g id="edge19" class="edge">
<title>decision_claimed&#45;&gt;state_new</title>
<path fill="none" stroke="black" d="M174.83,-24.21C118.34,-32.7 46.39,-55 46.39,-113.5 46.39,-464 46.39,-464 46.39,-464 46.39,-491.66 55.68,-521.06 65.52,-544.44"/>
<polygon fill="black" stroke="black" points="62.38,-545.99 69.6,-553.75 68.79,-543.18 62.38,-545.99"/>
<text text-anchor="middle" x="165.83" y="-28.01" font-family="Times,serif" font-size="14.00">no</text>
</g>
</g>
</svg>
